<!DOCTYPE html>
<html lang="tr" class="antialiased dark">

<head>
    <script>
        // HTTPS yönlendirmesi
        if (window.location.protocol !== "https:" && window.location.hostname !== "localhost" && window.location.hostname !== "127.0.0.1") {
            window.location.href = "https://" + window.location.host + window.location.pathname + window.location.search;
        }
    </script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }

        gtag('consent', 'default', {
            ad_storage: 'denied',
            analytics_storage: 'denied',
            wait_for_update: 500
        });
    </script>

    <script>
        (function () {
            const consent = localStorage.getItem('cookie_consent');

            if (consent === 'accepted') {
                loadGA();
            }

            function loadGA() {
                if (window.__ga_loaded) return;
                window.__ga_loaded = true;

                const s = document.createElement('script');
                s.async = true;
                s.src = 'https://www.googletagmanager.com/gtag/js?id=YOUR-GA-ID';
                document.head.appendChild(s);

                gtag('js', new Date());
                gtag('config', 'YOUR-GA-ID', {
                    anonymize_ip: true
                });
            }

            window.acceptCookies = function () {
                localStorage.setItem('cookie_consent', 'accepted');
                gtag('consent', 'update', {
                    ad_storage: 'granted',
                    analytics_storage: 'granted'
                });
                loadGA();
                document.getElementById('cookie-banner').classList.add('hidden');
            };

            window.rejectCookies = function () {
                localStorage.setItem('cookie_consent', 'rejected');
                document.getElementById('cookie-banner').classList.add('hidden');
            };
        })();
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#27374D">

    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/images/favicon.ico' | relative_url }}">
    <link rel="icon" href="{{ '/assets/images/favicon.ico' | relative_url }}" type="image/x-icon" />

    <meta name="title" content="{{ page.title | default: site.title }}" />
    <meta name="description" content="{{ page.description | default: site.description }}" />
    <meta name="author" content="{{ page.author | default: site.author }}" />
    <meta name="robots" content="INDEX, FOLLOW" />
    <link rel="canonical" href="{{ site.url }}{{ page.url }}" />

    <!-- Open Graph -->
    <meta property="og:site_name" content="{{ site.site_name | default: site.title }}" />
    <meta property="og:locale" content="{{ site.locale | default: 'en_US' }}" />
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}" />
    <meta property="og:url" content="{{ site.url }}{{ page.url }}" />
    <meta property="og:title" content="{{ page.title | default: site.title }}" />
    <meta property="og:description" content="{{ page.description | default: site.description }}" />
    <meta property="og:image"
        content="{% if page.image %}{{ site.url }}{{ page.image }}{% else %}{{ site.url }}{{ '/assets/images/og-image.jpg' | relative_url }}{% endif %}" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:site" content="@{{ site.twitter_username }}" />
    <meta property="twitter:creator" content="@{{ site.twitter_username }}" />
    <meta property="twitter:url" content="{{ site.url }}{{ page.url }}" />
    <meta property="twitter:title" content="{{ page.title | default: site.title }}" />
    <meta property="twitter:description" content="{{ page.description | default: site.description }}" />
    <meta property="twitter:image"
        content="{% if page.image %}{{ site.url }}{{ page.image }}{% else %}{{ site.url }}{{ '/assets/images/og-image.jpg' | relative_url }}{% endif %}" />

    <title>{{ page.title | default: site.title }}</title>

    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <link rel="stylesheet" href="{{ '/assets/main.css' | relative_url }}">
    <script defer src="{{ '/assets/alpine.min.js' | relative_url }}"></script>

    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>

    <script>
        (function () {
            try {
                // Check if darkMode is explicitly stored as 'false' (string)
                const isLightInfo = localStorage.getItem('darkMode') === 'false';

                // Default is DARK. So if it is NOT light info, we add dark.
                if (!isLightInfo) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }

                // Set the initial state for Alpine
                window.initialDarkMode = !isLightInfo;
            } catch (e) {
                console.error('Dark mode init failed', e);
                document.documentElement.classList.add('dark');
                window.initialDarkMode = true;
            }
        })();
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ site.url }}{{ page.url }}"
      },
      "headline": "{{ page.title | escape }}",
      "description": "{{ page.description | escape }}",
      "image": "{{ site.url }}/assets/images/og-image.jpg",
      "author": {
        "@type": "Person",
        "name": "{{ page.author | default: site.author }}",
        "url": "{{ site.url}}"
      },
      "publisher": {
        "@type": "Organization",
        "name": "{{ site.title }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ site.url }}/assets/images/favicon.ico"
        }
      },
      "datePublished": "{{ page.date | date_to_xmlschema }}",
      "dateModified": "{{ page.date | date_to_xmlschema }}"
    }
    </script>
</head>

<body x-data="{
        darkMode: window.initialDarkMode,
        searchOpen: false,
        toggle() {
            this.darkMode = !this.darkMode;
            localStorage.setItem('darkMode', this.darkMode);
            document.documentElement.classList.toggle('dark', this.darkMode);
        },
        toggleSearch() {
            this.searchOpen = !this.searchOpen;
            if (this.searchOpen) {
                // Focus the search input when it opens
                setTimeout(() => {
                    const input = document.getElementById('search-input');
                    if (input) input.focus();
                }, 100);
            }
        }
    }"
    class="bg-brand-light text-brand-dark transition-colors duration-300 dark:bg-brand-dark dark:text-brand-light min-h-screen font-sans antialiased">

    <div class="max-w-3xl mx-auto px-6 py-16 md:py-24">
        <header class="flex flex-col gap-6 mb-20 border-b border-brand-muted/30 dark:border-brand-accent/30 pb-10">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-extrabold tracking-tight">
                    <a href="{{ '/' | relative_url }}"
                        class="hover:text-brand-accent dark:hover:text-brand-muted transition-all">
                        {{ site.title }}
                    </a>
                </h1>
                <div class="flex items-center gap-2">
                    <!-- Search Toggle Button -->
                    <button @click="toggleSearch()"
                        class="p-3 rounded-2xl bg-brand-light text-brand-dark dark:bg-brand-dark dark:text-brand-light hover:bg-brand-accent dark:hover:bg-brand-muted transition-all duration-300 shadow-sm focus:outline-none flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    <!-- Dark Mode Toggle Button -->
                    <button @click="toggle()"
                        class="p-3 rounded-2xl bg-brand-light text-brand-dark dark:bg-brand-dark dark:text-brand-light hover:bg-brand-accent dark:hover:bg-brand-muted transition-all duration-300 shadow-sm focus:outline-none flex items-center justify-center">
                        <!-- Moon Icon (for Light Mode) -->
                        <svg x-show="!darkMode" title="Karanlık Mod" class="w-6 h-6" fill="currentColor"
                            viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                        </svg>
                        <!-- Sun Icon (for Dark Mode) -->
                        <svg x-show="darkMode" x-cloak title="Aydınlık Mod" class="w-6 h-6" fill="none"
                            stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="5"></circle>
                            <path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Search Area -->
            <div x-show="searchOpen" x-cloak x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 -translate-y-4" x-transition:enter-end="opacity-100 translate-y-0"
                x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 -translate-y-4"
                x-data="{
                searchQuery: '',
                posts: [],
                searchResults: [],
                isLoading: false,
                async initSearch() {
                    if (this.posts.length > 0) return;
                    this.isLoading = true;
                    try {
                        const response = await fetch('{{ '/search.json' | relative_url }}');
                        this.posts = await response.json();
                    } catch (error) {
                        console.error('Arama dizini yüklenemedi:', error);
                    }
                    this.isLoading = false;
                },
                search() {
                    if (this.searchQuery.trim().length < 2) {
                        this.searchResults = [];
                        return;
                    }
                    const query = this.searchQuery.toLocaleLowerCase('tr-TR');
                    this.searchResults = this.posts.filter(post =>
                        post.title.toLocaleLowerCase('tr-TR').includes(query) ||
                        post.content.toLocaleLowerCase('tr-TR').includes(query)
                    ).slice(0, 5); // Limit to top 5 results
                }
            }" class="relative w-full" @scroll.window.once="initSearch()">
                <div class="relative group">
                    <input id="search-input" type="text" x-model="searchQuery" @focus="initSearch()"
                        @input.debounce.300ms="search()" placeholder="Yazılarda ara..."
                        class="w-full px-5 py-3 pl-12 rounded-2xl bg-white/50 dark:bg-white/5 border border-brand-dark/10 dark:border-brand-light/10 focus:outline-none focus:ring-2 focus:ring-brand-accent transition-all dark:placeholder:text-gray-500">
                    <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 opacity-40 group-focus-within:opacity-100 transition-opacity"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>

                    <div x-show="isLoading" class="absolute right-4 top-1/2 -translate-y-1/2">
                        <svg class="animate-spin h-5 w-5 text-brand-accent" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                    </div>
                </div>

                <!-- Search Results Dropdown -->
                <div x-show="searchResults.length > 0" @click.away="searchResults = []"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 translate-y-2 scale-95"
                    x-transition:enter-end="opacity-100 translate-y-0 scale-100"
                    class="absolute top-full left-0 right-0 mt-3 p-2 bg-white dark:bg-brand-dark border border-brand-dark/10 dark:border-brand-light/10 rounded-2xl shadow-2xl z-50 backdrop-blur-xl">
                    <template x-for="result in searchResults" :key="result.url">
                        <a :href="result.url"
                            class="block p-4 hover:bg-brand-accent/10 dark:hover:bg-brand-light/5 rounded-xl transition-all group">
                            <div class="text-sm font-medium opacity-50 mb-1" x-text="result.date"></div>
                            <div class="text-lg font-bold group-hover:text-brand-accent transition-colors"
                                x-text="result.title"></div>
                        </a>
                    </template>
                </div>

                <div x-show="searchQuery.length >= 2 && searchResults.length === 0 && !isLoading"
                    class="absolute top-full left-0 right-0 mt-3 p-6 bg-white dark:bg-brand-dark border border-brand-dark/10 dark:border-brand-light/10 rounded-2xl shadow-2xl z-50 text-center opacity-60">
                    Sonuç bulunamadı.
                </div>
            </div>
        </header>

        <main class="min-h-[50vh]">
            {{ content }}
        </main>

        <footer
            class="mt-24 pt-12 border-t border-brand-muted/30 dark:border-brand-accent/30 text-sm opacity-60 text-center">
            <p>&copy; {{ site.time | date: "%Y" }} {{ site.title }}. Tüm hakları saklıdır.</p>
        </footer>
    </div>

    <!-- Cookie Banner with Custom Palette -->
    <div id="cookie-banner"
        class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] max-w-2xl p-6 bg-brand-light dark:bg-brand-dark text-brand-dark dark:text-brand-light text-sm text-center z-[9999] flex flex-col md:flex-row items-center justify-center gap-4 border border-brand-dark/10 dark:border-brand-light/10 backdrop-blur-sm bg-brand-light/95 dark:bg-brand-dark/95 rounded-2xl shadow-2xl"
        x-data="{ show: localStorage.getItem('cookie_consent') === null }" x-show="show" style="display: flex;">
        <p class="max-w-2xl leading-relaxed opacity-90">
            Bu site, ziyaretçi davranışlarını analiz etmek amacıyla Google Analytics çerezlerini kullanır.
            Onay vermediğiniz sürece analitik çerezler etkinleştirilmez.
        </p>
        <div class="flex gap-3">
            <button onclick="acceptCookies()" @click="show = false"
                class="px-6 py-2 bg-brand-dark dark:bg-brand-light text-brand-light dark:text-brand-dark hover:bg-brand-accent dark:hover:bg-brand-muted font-bold rounded-lg transition-colors whitespace-nowrap">
                Kabul Et
            </button>
            <button onclick="rejectCookies()" @click="show = false"
                class="px-6 py-2 bg-brand-accent text-brand-light hover:opacity-90 font-bold rounded-lg transition-colors whitespace-nowrap">
                Reddet
            </button>
        </div>
    </div>
</body>

</html>
